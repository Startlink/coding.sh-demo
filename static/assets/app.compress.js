var App=function(){function e(e){var t=$(window).height();if(Q=$("#header-menu").height(),$("#header").css("height",Q),!Y||!Y.getOption("fullScreen")){var o=t-Q;if(o>=0){$("#content").css("height",o),o-=X;var r=parseFloat($("#content #coding").css("height")),a=parseFloat($("#content #console").css("height")),i=.5;if(e||0>=r||0>=a)i=.5;else{var l=r+a;l>0&&(i=r/(r+a))}if(e&&Modernizr.localstorage){var s=localStorage.getItem("ratio");null!==s&&(i=parseFloat(s))}r=o*i,a=o-r,n(r,a)}}}function t(e){var t=$(window).height();e-=Q;var o=t-Q;if(o>=0){var r=e,a=o-r-X;n(r,a)}}function n(e,t){if($("#content #coding").css("height",e),$("#content #console").css("height",t),$("#run-loading,  #run-loading>.ui.segment").css("top",Q+e+X).css("left",Z),Y&&Y.setSize(null,e),Modernizr.localstorage){var n=e+t;n>0&&(ratio=e/(e+t),localStorage.setItem("ratio",ratio))}}function o(e){var t=parseInt(e);Y&&(2==t||4==t||3==t||8==t)&&(Y.setOption("indentUnit",t),h())}function r(){}function a(){Modernizr.localstorage&&ne&&localStorage.setItem("codemirror-keymap",ne)}function i(e){e&&Y&&("default"==e||"vim"==e||"emacs"==e||"sublime"==e)&&(ne=e,Y.setOption("keyMap",ne),l(),p(),r(),a())}function l(){if(ne){var e="기본";"default"==ne||("vim"==ne?e="Vim":"emacs"==ne?e="Emacs":"sublime"==ne&&(e="Sublime")),$("#editor-info").text(e)}}function s(){var e={"line-highlight":!0,"line-numbers":!0,"match-brackets":!0,"auto-close-brackets":!0,"fold-gutter":!1};if(oe=e,Modernizr.localstorage){var t=localStorage.getItem("codemirror-options");if(null!==t){var n=JSON.parse(t);if(n)for(var o in oe)o in n&&(oe[o]=n[o])}}}function c(){Modernizr.localstorage&&null!==oe&&localStorage.setItem("codemirror-options",JSON.stringify(oe))}function d(e){return $("#header .ui.main.menu .dropdown.settings-dropdown .ui.checkbox:has(input[name='"+e+"'])")}function u(){null===oe&&s();for(var e in oe){var t=d(e);t.checkbox(oe[e]?"check":"uncheck")}}function f(e,t){null===oe&&s(),e in oe&&(oe[e]=t,Y&&("line-numbers"==e?Y.setOption("lineNumbers",t):"line-highlight"==e?Y.setOption("styleActiveLine",t):"match-brackets"==e?Y.setOption("matchBrackets",t):"auto-close-brackets"==e?Y.setOption("autoCloseBrackets",t):"fold-gutter"==e&&(Y.setOption("foldGutter",t),t?Y.setOption("gutters",["CodeMirror-linenumbers","CodeMirror-foldgutter"]):Y.setOption("gutters",[])))),c()}function p(){var e={Tab:function(e){var t=new Array(e.getOption("indentUnit")+1).join(" ");e.replaceSelection(t)},F11:function(e){x(!1)},ESC:function(e){x(!0)},"Ctrl-R":function(e){V()},"Ctrl-B":function(e){H()}};"vim"==ne&&delete ians.ESC,Y.setOption("extraKeys",e)}function m(){Modernizr.localstorage&&(ne=localStorage.getItem("codemirror-keymap")),ne?"default"!=ne&&"vim"!=ne&&"emacs"!=ne&&"sublime"!=ne&&(ne="default"):ne="default",a(),l(),null===oe&&(s(),u());var e=document.getElementById("source");CodeMirror.modeURL="/assets/codemirror/mode/%N/%N.js",Y=CodeMirror.fromTextArea(e,{lineNumbers:oe["line-numbers"],matchBrackets:oe["match-brackets"],indentUnit:4,autoCloseBrackets:oe["auto-close-brackets"],theme:"lesser-dark",mode:"text/x-c++src",readOnly:"nocursor",keyMap:ne,styleActiveLine:oe["line-highlight"],foldGutter:oe["fold-gutter"],gutters:oe["fold-gutter"]?["CodeMirror-linenumbers","CodeMirror-foldgutter"]:[],selectionPointer:!0}),p(),h(),Y.on("cursorActivity",function(){var e=Y.getCursor();$("#line-info").text(e.line+1+":"+(e.ch+1))}),Y.on("changes",function(){})}function g(e,t){e=parseInt(e),t=parseInt(t),Y&&(Y.setCursor({ch:t,line:e}),Y.focus())}function h(){$("#indent-info").text(Y?Y.getOption("indentUnit"):"")}function v(){var e=$("#header .ui.main.menu .dropdown.indent-dropdown");e.dropdown({transition:"drop",action:function(t,n){o(t),e.dropdown("hide")}});var t=$("#header .ui.main.menu .dropdown.language-dropdown");t.dropdown({transition:"drop",action:function(e,n){I(e),t.dropdown("hide")}});var n=$("#header .ui.main.menu .dropdown.editor-dropdown");n.dropdown({transition:"drop",action:function(e,t){i(t),n.dropdown("hide")}});var r=$("#header .ui.main.menu .dropdown.settings-dropdown");r.dropdown({transition:"drop",action:function(e,t){}}),$("#header .ui.main.menu .dropdown.settings-dropdown .ui.checkbox").checkbox({onChange:function(){var e=$(this).attr("name"),t=$(this).parent("div.ui.checkbox").hasClass("checked");f(e,t)}})}function x(t){var n=Y.getOption("fullScreen");Y.setOption("fullScreen",t?!1:!n),n=Y.getOption("fullScreen"),n?$("#fullscreen-button .fa").removeClass("fa-expand").addClass("fa-compress"):(e(),$("#fullscreen-button .fa").removeClass("fa-compress").addClass("fa-expand"))}function b(){$(window).resize(function(){e()}),$("#header").click(function(){}),$(".editor-fullscreen").click(function(){x()}),$("#console-tab").mousedown(function(e){e.preventDefault();var t=$(this).position().top,n=e.pageY;K=n-t-Q}),$("#container").mousemove(function(e){K&&(e.preventDefault(),t(e.pageY-K))}).mouseup(function(e){K&&(e.preventDefault(),K=null)}),$("#header-create-file-link").click(function(e){e.preventDefault(),J(null,!1)}),$("#save-button").click(function(e){D()}),$("#run-button").click(function(e){D(),V()}),$("#compile-button").click(function(e){D(),H()}),$("#console-content").on("click","p span.output a.line-link",function(){g($(this).attr("data-line"),$(this).attr("data-char"))}),$("#save-button").click(function(e){D()}),$("#update-button").click(function(e){e.preventDefault(),$("#update-modal").modal("show")})}function w(e){e?$("#header #server-status .status").removeClass("red yellow green").addClass("yellow").transition("set looping").transition("pulse","500ms"):$("#header #server-status .status").transition("remove looping").removeClass("red yellow green").addClass("green")}function y(e){return{text:e.name,data:e,id:e.id,parent:e.parent,type:"folder"==e.type?"folder":"file",state:{opened:"folder"==e.type?!0:!1,disabled:!1,selected:"tree-root"==e.id?!0:!1}}}function _(e){var t=[];e.forEach(function(e,n,o){t.push(y(e))}),q=e,A();var n={core:{data:t,themes:{name:"default-dark"},multiple:!1,check_callback:function(e,t,n,o,r){return"rename_node"==e?"#"!=t.data.parent:"delete_node"==e?"#"!=t.data.parent:void 0}},plugins:["wholerow","sort","unique","contextmenu","types"],types:{folder:{icon:"fa fa-folder-open-o",valid_children:["folder","file"]},file:{icon:"fa fa-file-code-o",valid_children:[]},"#":{max_depth:4,max_children:20}},contextmenu:{select_node:!0,show_at_node:!1,items:function(e,t){return{create_folder:{separator_before:!1,separator_after:!1,_disabled:!1,label:"새 폴더",action:function(e){J(e,!0)},icon:"fa fa-folder-o"},create_file:{separator_before:!1,separator_after:!0,_disabled:!1,label:"새 파일",action:function(e){J(e,!1)},icon:"fa fa-file-text-o"},rename_node:{separator_before:!1,separator_after:!0,_disabled:!1,label:"이름 바꾸기",action:function(e){if(!S(e)){var t=$.jstree.reference(e.reference),n=t.get_node(e.reference);t.edit(n)}},icon:"",shortcut:113,shortcut_label:"F2"},delete_node:{separator_before:!1,separator_after:!1,_disabled:function(e){return S(e)},label:"삭제",action:function(e){if(!S(e)){var t=$.jstree.reference(e.reference),n=t.get_node(e.reference);L(t,n)}},icon:"fa fa-trash-o"}}}},sort:function(e,t){var n=this.get_node(e),o=this.get_node(t);return n.type!=o.type?n.type<o.type?1:-1:this.get_text(e).toLowerCase()<this.get_text(t).toLowerCase()?-1:1}},o=$("#sidebar-tree");o.jstree(n),o.on("changed.jstree",function(e,t){t.node&&"file"==t.node.data.type&&ee!=t.node.data.id&&N(t.node.data.id)}),o.on("rename_node.jstree",function(e,t){t.node&&t.text.length&&O(t.node.data.id,t.text)}),o.on("delete_node.jstree",function(e,t){t.node&&t.node.data.id&&C(t.node.data.id)})}function k(e){var t={language:"Text",mime:"text/plain"};if(e){var n=CodeMirror.findModeByExtension(e);n&&(t.language=n.name,t.mime=n.mime)}return t}function C(e){te[e]&&delete te[e],ee=null,Y.setOption("readOnly",!0);for(var t=0;t<q.length;t++)if(q[t].id==e){q.splice(t,1);break}Modernizr.localstorage&&localStorage.removeItem(e),A()}function M(e){if(q)for(var t=0;t<q.length;t++)if(q[t].id==e)return t;return-1}function O(e,t){var n=j(e),o=M(e);if(-1!=o&&(q[o].name=t,"file"==n.type)){var r=/.+\.([^.]+)$/.exec(t),a=null,i=k();r&&(a=r[1],i=k(a)),q[o].language=i.language,q[o].mime=i.mime,e==ee&&z(i.mime,i.language)}A()}function S(e){var t=$.jstree.reference(e.reference),n=t.get_node(e.reference);return"#"==n.parent}function I(e){if(e&&Y&&ee){var t=j(ee),n=M(ee),o=null;if(null===t)return;"C++"==e?o="text/x-c++src":"Plain Text"==e&&(o="text/plain"),o&&(q[n].language=e,q[n].mime=o,z(o,e),A())}}function z(e,t){var n,o,r=CodeMirror.findModeByMIME(e);r&&(n=r.mode,o=e),n&&(Y.setOption("mode",o),CodeMirror.autoLoadMode(Y,n),$("#language-info").text(t))}function T(e,t,n,o){if(ee){var r=Y.getHistory();te[ee]=JSON.stringify(r),D()}ee=null;var a=CodeMirror.Doc(t,n,0);Y.swapDoc(a),$("#line-info").text("1:1"),te[e]&&Y.setHistory(JSON.parse(te[e])),Y.setOption("readOnly",!1),z(n,o),Y.focus(),ee=e}function j(e){for(var t=0;t<q.length;t++)if(q[t].id==e)return q[t];return null}function N(e){$("#coding").dimmer({closable:!1}).dimmer("show"),w(!0),Y&&Y.getInputField().blur(),setTimeout(function(){var t=j(e);null!==t&&(Modernizr.localstorage&&null!==localStorage.getItem(e)?T(e,localStorage.getItem(e),t.mime,t.language):$.ajax("/samples/"+t.name).done(function(n){Modernizr.localstorage&&localStorage.setItem(e,n),T(e,n,t.mime,t.language)}).fail(function(){Modernizr.localstorage&&(localStorage.setItem(e,""),T(e,"",t.mime,t.language))}),$("#coding").dimmer("hide"),w(!1))},500)}function E(){var e=null;if(Modernizr.localstorage){var t=localStorage.getItem("files");t&&(e=JSON.parse(t))}e||(e=[{name:"~/",type:"folder",id:"tree-root",parent:"#"},{file:"sample2.cpp",name:"sample2.cpp",language:"C++",mime:"text/x-c++src",id:"sample2",type:"file",parent:"tree-root"},{file:"sample.cpp",name:"sample.cpp",language:"C++",mime:"text/x-c++src",id:"sample",type:"file",parent:"tree-root"},{file:"helloworld.cpp",name:"helloworld.cpp",language:"C++",mime:"text/x-c++src",id:"helloworld",type:"file",parent:"tree-root"}]),_(e)}function A(){Modernizr.localstorage&&localStorage.setItem("files",JSON.stringify(q))}function B(){ee&&Modernizr.localstorage&&localStorage.setItem(ee,Y.getValue())}function D(){B()}function F(e,t){var n=e?"New Folder":"New File",o={};if(q.forEach(function(e,r,a){e.parent==t&&e.name.startsWith(n)&&(o[e.name]=!0)}),o[n])for(var r=1;;r++){var a=n+" ("+r+")";if(!o[a]){n=a;break}}var i={file:n,name:n,id:W(),type:e?"folder":"file",parent:t};return e||(i.language="Plain Text",i.mime="text/plain"),q.push(i),A(),y(i)}function J(e,t){var n=null;n=e?e.reference:$("#sidebar-tree").jstree(!0).get_selected();for(var o=$.jstree.reference(n),r=o.get_node(n);"file"==r.data.type;)r=o.get_node(o.get_parent(r));var a=F(t,r.id);o.create_node(r,a,"last",function(e){setTimeout(function(){o.edit(e)},0)})}function L(e,t){var n=null;n=e.is_selected(t)?e.get_selected():t,$.isArray(n)&&n.length>0&&(n=n[0]);var o=j(n);$("#delete-alert .file-type").text("foler"==o.type?"폴더":"파일"),$("#delete-alert .file-name").text(o.name),$("#delete-alert").modal({closable:!1,onDeny:function(){},onApprove:function(){e.delete_node(e.is_selected(t)?e.get_selected():t)}}).modal("show")}function U(e,t){for(var n="",o=e;o>0;--o)n+=t[Math.round(Math.random()*(t.length-1))];return n}function W(){return U(32,"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ")}function P(e,t,n,o,r){var a=$("#console-content"),i="baekjoon@coding.sh:~# ";if(t)return void a.empty();var l=$("<p></p>");if(o&&l.append($('<span class="pwd"></span>').text(i)),a.append(l),e.length>0){var s=$("<span></span>");l.append(s),n?(s.addClass("typed"),s.typed({strings:[e],contentType:"text",showCursor:!1,callback:function(){}})):(s.addClass("output"),s.text(e))}r&&$("#console-content").scrollTo(l)}function G(){}function H(){if(null!==ee){var e=j(ee);"sample2.cpp"==e.name&&($("#console").dimmer({closable:!1}).dimmer("show"),w(!0),$("#console .ui.dimmer .text-message").text("준비중"),P("",!0,!1,!1,!0),setTimeout(function(){$("#console .ui.dimmer .text-message").text("컴파일 하는 중"),P("g++ -O2 -o sample2 -std=c++0x sample2.cpp",!1,!0,!0,!0),setTimeout(function(){re.forEach(function(e,t,n){P(e,!1,!1,!1,t==n.length-1?!0:!1)}),G(),R(),$("#console").dimmer("hide"),w(!1)},2e3)},500))}}function R(){$("#console-content p span.output").each(function(e){var t=$(this).text(),n=t.indexOf(" ");if(0>=n)return!0;var o=t.substring(0,n),r=t.substring(n);if(t=o.split(":"),t.length>=3){var a=parseInt(t[1])-1,i=parseInt(t[2])-1;a>=0&&i>=0&&($(this).html(""),$(this).append($("<a></a>").addClass("line-link").attr("data-line",a).attr("data-char",i).attr("href","javascript:void(0)").text(o)),$(this).append($("<span></span>").addClass("line-message").text(r)))}})}function V(){if(null!==ee){var e=j(ee);"sample.cpp"==e.name&&($("#console").dimmer({closable:!1}).dimmer("show"),w(!0),$("#console .ui.dimmer .text-message").text("준비중"),P("",!0,!1,!1,!0),setTimeout(function(){$("#console .ui.dimmer .text-message").text("컴파일 하는 중"),P("g++ -O2 -o sample -std=c++0x sample.cpp",!1,!0,!0,!0),setTimeout(function(){$("#console .ui.dimmer .text-message").text("sample.cpp < data.in 실행중"),P("./sample < data.in",!1,!0,!0,!0),setTimeout(function(){$("#console .ui.dimmer .text-message").text("sample.cpp < data2.in 실행중"),P("./sample < data2.in",!1,!0,!0,!0),setTimeout(function(){$("#console").dimmer("hide"),w(!1)},2e3)},2e3)},2e3)},500))}}var Y=null,q=null,K=null,Q=35,X=26,Z=240,ee=null,te={},ne=null,oe=null,re=["sample2.cpp: In function ‘int main()’:","sample2.cpp:20:5: error: expected primary-expression before ‘?’ token","     ?","     ^","sample2.cpp:21:5: error: expected primary-expression before ‘return’","     return 0;","     ^","sample2.cpp:21:5: error: expected ‘:’ before ‘return’","sample2.cpp:21:5: error: expected primary-expression before ‘return’","sample2.cpp:21:5: error: expected ‘;’ before ‘return’","sample2.cpp:6:19: warning: ignoring return value of ‘int scanf(const char*, ...)’, declared with attribute warn_unused_result [-Wunused-result]",'     scanf("%d",&n);',"                   ^","sample2.cpp:10:23: warning: ignoring return value of ‘int scanf(const char*, ...)’, declared with attribute warn_unused_result [-Wunused-result]",'         scanf("%d",&x);',"                       ^","sample2.cpp:13:19: warning: ignoring return value of ‘int scanf(const char*, ...)’, declared with attribute warn_unused_result [-Wunused-result]",'     scanf("%d",&x);',"                   ^"];return{init:function(){m(),e(!0),b(),v(),E(),$("#loading").remove()}}}();