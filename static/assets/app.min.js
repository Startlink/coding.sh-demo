var App=function(){var e=null;var t=null;var n=null;var r=null;var a=35;var i=26;var o=240;var l=null;var s={};var u={};var c=null;var f=null;function d(t){var n=$(window).height();a=$("#header-menu").height();$("#header").css("height",a);if(e&&e.getOption("fullScreen")){return}var r=n-a;if(r>=0){$("#content").css("height",r);r-=i;var o=parseFloat($("#content #coding").css("height"));var l=parseFloat($("#content #console").css("height"));var s=.5;if(t||o<=0||l<=0){s=.5}else{var u=o+l;if(u>0){s=o/(o+l)}}if(t&&Modernizr.localstorage){var c=localStorage.getItem("ratio");if(c!==null){s=parseFloat(c)}}o=r*s;l=r-o;m(o,l)}}function p(e){var t=$(window).height();e-=a;var n=t-a;if(n>=0){var r=e;var o=n-r-i;m(r,o)}}function m(t,n){$("#content #coding").css("height",t);$("#content #console").css("height",n);$("#run-loading,  #run-loading>.ui.segment").css("top",a+t+i).css("left",o);if(e){e.setSize(null,t)}if(Modernizr.localstorage){var r=t+n;if(r>0){ratio=t/(t+n);localStorage.setItem("ratio",ratio)}}}function g(t){var n=parseInt(t);if(e){if(n==2||n==4||n==3||n==8){e.setOption("indentUnit",n);I()}}}function v(){}function h(){if(Modernizr.localstorage&&c){localStorage.setItem("codemirror-keymap",c)}}function x(t){if(t&&e){if(t=="default"||t=="vim"||t=="emacs"||t=="sublime"){c=t;e.setOption("keyMap",c);b();M();v();h()}}}function b(){if(c){var e="기본";if(c=="default"){}else if(c=="vim"){e="Vim"}else if(c=="emacs"){e="Emacs"}else if(c=="sublime"){e="Sublime"}$("#editor-info").text(e)}}function w(){var e={"line-highlight":true,"line-numbers":true,"match-brackets":true,"auto-close-brackets":true,"fold-gutter":false};f=e;if(Modernizr.localstorage){var t=localStorage.getItem("codemirror-options");if(t!==null){var n=JSON.parse(t);if(n){for(var r in f){if(r in n){f[r]=n[r]}}}}}}function y(){if(Modernizr.localstorage&&f!==null){localStorage.setItem("codemirror-options",JSON.stringify(f))}}function _(e){return $("#header .ui.main.menu .dropdown.settings-dropdown .ui.checkbox:has(input[name='"+e+"'])")}function k(){if(f===null){w()}for(var e in f){var t=_(e);t.checkbox(f[e]?"check":"uncheck")}}function C(t,n){if(f===null){w()}if(t in f){f[t]=n;if(e){if(t=="line-numbers"){e.setOption("lineNumbers",n)}else if(t=="line-highlight"){e.setOption("styleActiveLine",n)}else if(t=="match-brackets"){e.setOption("matchBrackets",n)}else if(t=="auto-close-brackets"){e.setOption("autoCloseBrackets",n)}else if(t=="fold-gutter"){e.setOption("foldGutter",n);if(n){e.setOption("gutters",["CodeMirror-linenumbers","CodeMirror-foldgutter"])}else{e.setOption("gutters",[])}}}}y()}function M(){var t={Tab:function(e){var t=new Array(e.getOption("indentUnit")+1).join(" ");e.replaceSelection(t)},F11:function(e){j(false)},ESC:function(e){j(true)},"Ctrl-R":function(e){se()},"Ctrl-B":function(e){oe()}};if(c=="vim"){delete ians["ESC"]}e.setOption("extraKeys",t)}function O(){if(Modernizr.localstorage){c=localStorage.getItem("codemirror-keymap")}if(c){if(c!="default"&&c!="vim"&&c!="emacs"&&c!="sublime"){c="default"}}else{c="default"}h();b();if(f===null){w();k()}var t=document.getElementById("source");CodeMirror.modeURL="/assets/codemirror/mode/%N/%N.js";e=CodeMirror.fromTextArea(t,{lineNumbers:f["line-numbers"],matchBrackets:f["match-brackets"],indentUnit:4,autoCloseBrackets:f["auto-close-brackets"],theme:"lesser-dark",mode:"text/x-c++src",readOnly:"nocursor",keyMap:c,styleActiveLine:f["line-highlight"],foldGutter:f["fold-gutter"],gutters:f["fold-gutter"]?["CodeMirror-linenumbers","CodeMirror-foldgutter"]:[],selectionPointer:true});M();I();e.on("cursorActivity",function(){var t=e.getCursor();$("#line-info").text(t.line+1+":"+(t.ch+1))});e.on("changes",function(){})}function S(t,n){t=parseInt(t);n=parseInt(n);if(e){e.setCursor({ch:n,line:t});e.focus()}}function I(){if(e){$("#indent-info").text(e.getOption("indentUnit"))}else{$("#indent-info").text("")}}function T(){var e=$("#header .ui.main.menu .dropdown.indent-dropdown");e.dropdown({transition:"drop",action:function(t,n){g(t);e.dropdown("hide")}});var t=$("#header .ui.main.menu .dropdown.language-dropdown");t.dropdown({transition:"drop",action:function(e,n){J(e);t.dropdown("hide")}});var n=$("#header .ui.main.menu .dropdown.editor-dropdown");n.dropdown({transition:"drop",action:function(e,t){x(t);n.dropdown("hide")}});var r=$("#header .ui.main.menu .dropdown.settings-dropdown");r.dropdown({transition:"drop",action:function(e,t){}});$("#header .ui.main.menu .dropdown.settings-dropdown .ui.checkbox").checkbox({onChange:function(){var e=$(this).attr("name");var t=$(this).parent("div.ui.checkbox").hasClass("checked");C(e,t)}})}function j(t){var n=e.getOption("fullScreen");e.setOption("fullScreen",t?false:!n);n=e.getOption("fullScreen");if(n){$("#fullscreen-button .fa").removeClass("fa-expand").addClass("fa-compress")}else{d();$("#fullscreen-button .fa").removeClass("fa-compress").addClass("fa-expand")}}function z(){$(window).resize(function(){d()});$("#header").click(function(){});$(".editor-fullscreen").click(function(){j()});$("#console-tab").mousedown(function(e){e.preventDefault();var t=$(this).position().top;var n=e.pageY;r=n-t-a});$("#container").mousemove(function(e){if(r){e.preventDefault();p(e.pageY-r)}}).mouseup(function(e){if(r){e.preventDefault();r=null}});$("#header-create-file-link").click(function(e){e.preventDefault();X(null,false)});$("#save-button").click(function(e){K()});$("#run-button").click(function(e){K();se()});$("#compile-button").click(function(e){K();oe()});$("#console-content").on("click","p span.output a.line-link",function(){S($(this).attr("data-line"),$(this).attr("data-char"))});$("#save-button").click(function(e){K()});$("#update-button").click(function(e){e.preventDefault();$("#update-modal").modal("show")})}function N(e){if(e){$("#header #server-status .status").removeClass("red yellow green").addClass("yellow").transition("set looping").transition("pulse","500ms")}else{$("#header #server-status .status").transition("remove looping").removeClass("red yellow green").addClass("green")}}function E(e){return{text:e.name,data:e,id:e.id,parent:e.parent,type:e.type=="folder"?"folder":"file",state:{opened:e.type=="folder"?true:false,disabled:false,selected:e.id=="tree-root"?true:false}}}function A(e){var n=[];e.forEach(function(e,t,r){n.push(E(e))});t=e;Y();var r={core:{data:n,themes:{name:"default-dark"},multiple:false,check_callback:function(e,t,n,r,a){if(e=="rename_node"){return t.data.parent!="#"}else if(e=="delete_node"){return t.data.parent!="#"}}},plugins:["wholerow","sort","unique","contextmenu","types"],types:{folder:{icon:"fa fa-folder-open-o",valid_children:["folder","file"]},file:{icon:"fa fa-file-code-o",valid_children:[]},"#":{max_depth:4,max_children:20}},contextmenu:{select_node:true,show_at_node:false,items:function(e,t){return{create_folder:{separator_before:false,separator_after:false,_disabled:false,label:"새 폴더",action:function(e){X(e,true)},icon:"fa fa-folder-o"},create_file:{separator_before:false,separator_after:true,_disabled:false,label:"새 파일",action:function(e){X(e,false)},icon:"fa fa-file-text-o"},rename_node:{separator_before:false,separator_after:true,_disabled:false,label:"이름 바꾸기",action:function(e){if(W(e))return;var t=$.jstree.reference(e.reference),n=t.get_node(e.reference);t.edit(n)},icon:"",shortcut:113,shortcut_label:"F2"},delete_node:{separator_before:false,separator_after:false,_disabled:function(e){return W(e)},label:"삭제",action:function(e){if(W(e))return;var t=$.jstree.reference(e.reference),n=t.get_node(e.reference);Z(t,n)},icon:"fa fa-trash-o"}}}},sort:function(e,t){var n=this.get_node(e);var r=this.get_node(t);if(n.type!=r.type){return n.type<r.type?1:-1}else{return this.get_text(e).toLowerCase()<this.get_text(t).toLowerCase()?-1:1}}};var a=$("#sidebar-tree");a.jstree(r);a.on("changed.jstree",function(e,t){if(t.node&&t.node.data.type=="file"){if(l!=t.node.data.id){G(t.node.data.id)}}});a.on("rename_node.jstree",function(e,t){if(t.node&&t.text.length){L(t.node.data.id,t.text)}});a.on("delete_node.jstree",function(e,t){if(t.node&&t.node.data.id){D(t.node.data.id)}})}function B(e){var t={language:"Text",mime:"text/plain"};if(e){var n=CodeMirror.findModeByExtension(e);if(n){t.language=n.name;t.mime=n.mime}}return t}function D(n){if(s[n]){delete s[n]}l=null;e.setOption("readOnly",true);for(var r=0;r<t.length;r++){if(t[r].id==n){t.splice(r,1);break}}if(Modernizr.localstorage){localStorage.removeItem(n)}Y()}function F(e){if(t){for(var n=0;n<t.length;n++){if(t[n].id==e){return n}}}return-1}function L(e,n){var r=P(e);var a=F(e);if(a!=-1){t[a].name=n;if(r.type=="file"){var i=/.+\.([^.]+)$/.exec(n);var o=null;var s=B();if(i){o=i[1];s=B(o)}t[a].language=s.language;t[a].mime=s.mime;if(e==l){U(s.mime,s.language)}}}Y()}function W(e){var t=$.jstree.reference(e.reference),n=t.get_node(e.reference);return n.parent=="#"}function J(n){if(n&&e&&l){var r=P(l);var a=F(l);var i=null;if(r===null)return;if(n=="C++"){i="text/x-c++src"}else if(n=="Plain Text"){i="text/plain"}if(i){t[a].language=n;t[a].mime=i;U(i,n);Y()}}}function U(t,n){var r,a;var i=CodeMirror.findModeByMIME(t);if(i){r=i.mode;a=t}if(r){e.setOption("mode",a);CodeMirror.autoLoadMode(e,r);$("#language-info").text(n)}}function H(t,n,r,a){if(l){var i=e.getHistory();s[l]=JSON.stringify(i);K()}l=null;var o=CodeMirror.Doc(n,r,0);e.swapDoc(o);$("#line-info").text("1:1");if(s[t]){e.setHistory(JSON.parse(s[t]))}e.setOption("readOnly",false);U(r,a);e.focus();l=t}function P(e){for(var n=0;n<t.length;n++){if(t[n].id==e){return t[n]}}return null}function G(t){$("#coding").dimmer({closable:false}).dimmer("show");N(true);if(e){e.getInputField().blur()}setTimeout(function(){var e=P(t);if(e===null)return;if(Modernizr.localstorage&&localStorage.getItem(t)!==null){H(t,localStorage.getItem(t),e.mime,e.language)}else{$.ajax("/samples/"+e.name).done(function(n){if(Modernizr.localstorage){localStorage.setItem(t,n)}H(t,n,e.mime,e.language)}).fail(function(){if(Modernizr.localstorage){localStorage.setItem(t,"");H(t,"",e.mime,e.language)}})}$("#coding").dimmer("hide");N(false)},500)}function R(e){var t=e+"_anchor";var n=$("#sidebar-tree").jstree(true);var r=n.get_selected(true);n.deselect_node(r);n.select_node(e)}function V(){var e=null;if(Modernizr.localstorage){var t=localStorage.getItem("files");if(t){e=JSON.parse(t)}}if(e){}else{e=[{name:"~/",type:"folder",id:"tree-root",parent:"#"},{file:"sample2.cpp",name:"sample2.cpp",language:"C++",mime:"text/x-c++src",id:"sample2",type:"file",parent:"tree-root"},{file:"sample.cpp",name:"sample.cpp",language:"C++",mime:"text/x-c++src",id:"sample",type:"file",parent:"tree-root"},{file:"helloworld.cpp",name:"helloworld.cpp",language:"C++",mime:"text/x-c++src",id:"helloworld",type:"file",parent:"tree-root"}]}A(e)}function Y(){if(Modernizr.localstorage){localStorage.setItem("files",JSON.stringify(t))}}function q(){if(l){if(Modernizr.localstorage){localStorage.setItem(l,e.getValue())}}}function K(){q()}function Q(e,n){var r=e?"New Folder":"New File";var a={};t.forEach(function(e,t,i){if(e.parent==n){if(e.name.startsWith(r)){a[e.name]=true}}});if(a[r]){for(var i=1;;i++){var o=r+" ("+i+")";if(a[o]){}else{r=o;break}}}var l={file:r,name:r,id:te(),type:e?"folder":"file",parent:n};if(!e){l.language="Plain Text";l.mime="text/plain"}t.push(l);Y();return E(l)}function X(e,t){var n=null;if(e){n=e.reference}else{n=$("#sidebar-tree").jstree(true).get_selected()}var r=$.jstree.reference(n),a=r.get_node(n);while(a.data.type=="file"){a=r.get_node(r.get_parent(a))}var i=Q(t,a.id);r.create_node(a,i,"last",function(e){setTimeout(function(){r.edit(e)},0)})}function Z(e,t){var n=null;if(e.is_selected(t)){n=e.get_selected()}else{n=t}if($.isArray(n)&&n.length>0){n=n[0]}var r=P(n);$("#delete-alert .file-type").text(r.type=="foler"?"폴더":"파일");$("#delete-alert .file-name").text(r.name);$("#delete-alert").modal({closable:false,onDeny:function(){},onApprove:function(){if(e.is_selected(t)){e.delete_node(e.get_selected())}else{e.delete_node(t)}}}).modal("show")}function ee(e,t){var n="";for(var r=e;r>0;--r)n+=t[Math.round(Math.random()*(t.length-1))];return n}function te(){return ee(32,"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ")}function ne(e,t,n,r,a){var i=$("#console-content");var o="baekjoon@coding.sh:~# ";if(t){i.empty();return}var l=$("<p></p>");if(r){l.append($('<span class="pwd"></span>').text(o))}i.append(l);if(e.length>0){var s=$("<span></span>");l.append(s);if(n){s.addClass("typed");s.typed({strings:[e],contentType:"text",showCursor:false,callback:function(){}})}else{s.addClass("output");s.text(e)}}if(a){$("#console-content").scrollTo(l)}}var re=["sample2.cpp: In function ‘int main()’:","sample2.cpp:20:5: error: expected primary-expression before ‘?’ token","     ?","     ^","sample2.cpp:21:5: error: expected primary-expression before ‘return’","     return 0;","     ^","sample2.cpp:21:5: error: expected ‘:’ before ‘return’","sample2.cpp:21:5: error: expected primary-expression before ‘return’","sample2.cpp:21:5: error: expected ‘;’ before ‘return’","sample2.cpp:6:19: warning: ignoring return value of ‘int scanf(const char*, ...)’, declared with attribute warn_unused_result [-Wunused-result]",'     scanf("%d",&n);',"                   ^","sample2.cpp:10:23: warning: ignoring return value of ‘int scanf(const char*, ...)’, declared with attribute warn_unused_result [-Wunused-result]",'         scanf("%d",&x);',"                       ^","sample2.cpp:13:19: warning: ignoring return value of ‘int scanf(const char*, ...)’, declared with attribute warn_unused_result [-Wunused-result]",'     scanf("%d",&x);',"                   ^"];var ae=[{line:20,type:"error",msg:"error: expected primary-expression before ‘?’ token"},{line:21,type:"error",msg:"error: expected primary-expression before ‘return’"},{line:21,type:"error",msg:"error: expected ‘:’ before ‘return’"},{line:21,type:"error",msg:"error: expected primary-expression before ‘return’"},{line:21,type:"error",msg:"error: expected ‘;’ before ‘return’"},{line:6,type:"warning",msg:"warning: ignoring return value of ‘int scanf(const char*, ...)’, declared with attribute warn_unused_result [-Wunused-result]"},{line:10,type:"warning",msg:"warning: ignoring return value of ‘int scanf(const char*, ...)’, declared with attribute warn_unused_result [-Wunused-result]"},{line:13,type:"warning",msg:"warning: ignoring return value of ‘int scanf(const char*, ...)’, declared with attribute warn_unused_result [-Wunused-result]"}];function ie(){return;if(e===null)return;ae.forEach(function(t,n,r){if(t.type=="note"){return}var a=document.createElement("div");var i=a.appendChild(document.createElement("span"));i.innerHTML="!";i.className="lint-"+t.type+"-icon";a.appendChild(document.createTextNode(t.msg));a.className="lint-error";e.addLineWidget(t.line-1,a)})}function oe(){if(l===null)return;var e=P(l);if(e.name!="sample2.cpp")return;$("#console").dimmer({closable:false}).dimmer("show");N(true);$("#console .ui.dimmer .text-message").text("준비중");ne("",true,false,false,true);setTimeout(function(){$("#console .ui.dimmer .text-message").text("컴파일 하는 중");ne("g++ -O2 -o sample2 -std=c++0x sample2.cpp",false,true,true,true);setTimeout(function(){re.forEach(function(e,t,n){ne(e,false,false,false,t==n.length-1?true:false)});ie();le();$("#console").dimmer("hide");N(false)},2e3)},500)}function le(){$("#console-content p span.output").each(function(e){var t=$(this).text();var n=t.indexOf(" ");if(n<=0)return true;var r=t.substring(0,n);var a=t.substring(n);t=r.split(":");if(t.length>=3){var i=parseInt(t[1])-1;var o=parseInt(t[2])-1;if(i>=0&&o>=0){$(this).html("");$(this).append($("<a></a>").addClass("line-link").attr("data-line",i).attr("data-char",o).attr("href","javascript:void(0)").text(r));$(this).append($("<span></span>").addClass("line-message").text(a))}}})}function se(){if(l===null)return;var e=P(l);if(e.name!="sample.cpp")return;$("#console").dimmer({closable:false}).dimmer("show");N(true);$("#console .ui.dimmer .text-message").text("준비중");ne("",true,false,false,true);setTimeout(function(){$("#console .ui.dimmer .text-message").text("컴파일 하는 중");ne("g++ -O2 -o sample -std=c++0x sample.cpp",false,true,true,true);setTimeout(function(){$("#console .ui.dimmer .text-message").text("sample.cpp < data.in 실행중");ne("./sample < data.in",false,true,true,true);setTimeout(function(){$("#console .ui.dimmer .text-message").text("sample.cpp < data2.in 실행중");ne("./sample < data2.in",false,true,true,true);setTimeout(function(){$("#console").dimmer("hide");N(false)},2e3)},2e3)},2e3)},500)}return{init:function(){O();d(true);z();T();V();$("#loading").remove()}}}();